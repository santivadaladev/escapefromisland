<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Escape from Island</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Pirata+One&family=Crimson+Pro:wght@400;600&display=swap');

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: #0a1628;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    font-family: 'Crimson Pro', serif;
    color: #e8d5a3;
    overflow: hidden;
  }

  #title {
    font-family: 'Pirata One', cursive;
    font-size: 2rem;
    color: #f0c040;
    text-shadow: 0 0 20px #f0c04066;
    margin-bottom: 10px;
    letter-spacing: 3px;
  }

  #hud {
    display: flex;
    gap: 30px;
    margin-bottom: 8px;
    font-size: 1rem;
    color: #e8d5a3;
  }

  .hud-item { display: flex; align-items: center; gap: 6px; }
  .hud-icon { font-size: 1.2rem; }

  #gameCanvas {
    border: 3px solid #8b6914;
    border-radius: 4px;
    box-shadow: 0 0 40px #f0c04033, inset 0 0 30px #00000066;
    cursor: none;
    display: block;
  }

  #message {
    margin-top: 10px;
    font-size: 1.1rem;
    color: #a8e6cf;
    min-height: 24px;
    font-style: italic;
    text-align: center;
  }

  #controls {
    margin-top: 8px;
    font-size: 0.85rem;
    color: #8b7355;
    text-align: center;
  }

  #winScreen {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.85);
    align-items: center;
    justify-content: center;
    flex-direction: column;
    gap: 20px;
    z-index: 100;
  }

  #winScreen h2 {
    font-family: 'Pirata One', cursive;
    font-size: 3rem;
    color: #f0c040;
    text-shadow: 0 0 30px #f0c040;
    animation: pulse 1.5s infinite;
  }

  #winScreen p { font-size: 1.3rem; color: #a8e6cf; }

  #restartBtn {
    padding: 12px 32px;
    background: #8b6914;
    color: #f0c040;
    border: 2px solid #f0c040;
    font-family: 'Pirata One', cursive;
    font-size: 1.2rem;
    cursor: pointer;
    border-radius: 4px;
    letter-spacing: 2px;
    transition: all 0.2s;
  }

  #restartBtn:hover { background: #f0c040; color: #1a0a00; }

  @keyframes pulse {
    0%, 100% { text-shadow: 0 0 20px #f0c040; }
    50% { text-shadow: 0 0 60px #f0c040, 0 0 100px #ffaa00; }
  }
</style>
</head>
<body>

<div id="title">âš“ ESCAPE FROM ISLAND âš“</div>

<div id="hud">
  <div class="hud-item"><span class="hud-icon">ðŸªµ</span> Legna: <strong id="woodCount">0</strong>/8</div>
  <div class="hud-item"><span class="hud-icon">ðŸŒŠ</span> Stato: <strong id="raftStatus">â€”</strong></div>
</div>

<canvas id="gameCanvas" width="700" height="460"></canvas>

<div id="message">Raccogli 8 pezzi di legna per costruire la zattera!</div>
<div id="controls">WASD / Frecce per muoversi â€¢ Avvicinati agli alberi per raccogliere â€¢ Avvicinati alla spiaggia con tutta la legna per fuggire!</div>

<div id="winScreen">
  <h2>ðŸŽ‰ SEI LIBERO! ðŸŽ‰</h2>
  <p>Hai costruito la zattera e sei fuggito dall'isola!</p>
  <button id="restartBtn" onclick="initGame()">Gioca Ancora</button>
</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const W = canvas.width, H = canvas.height;

let game;

function initGame() {
  document.getElementById('winScreen').style.display = 'none';
  game = {
    wood: 0,
    raftBuilt: false,
    message: 'Raccogli 8 pezzi di legna per costruire la zattera!',
    player: { x: 350, y: 250, w: 22, h: 28, speed: 3 },
    trees: generateTrees(),
    raft: { x: 630, y: 380, w: 50, h: 30, visible: false },
    waves: [],
    particles: [],
    time: 0,
    keys: {}
  };
  for(let i=0;i<6;i++) game.waves.push({ x: Math.random()*W, y: -20+Math.random()*H*0.15, speed: 0.4+Math.random()*0.4, offset: Math.random()*Math.PI*2 });
  updateHUD();
}

function generateTrees() {
  const positions = [
    {x:120,y:150},{x:200,y:100},{x:300,y:80},{x:450,y:120},{x:530,y:170},
    {x:100,y:280},{x:170,y:350},{x:250,y:300},{x:400,y:280},{x:480,y:320},
    {x:550,y:260},{x:350,y:380},{x:270,y:420},{x:140,y:420}
  ];
  return positions.map((p,i) => ({ ...p, id:i, w:30, h:50, collected:false, shake:0 }));
}

function updateHUD() {
  document.getElementById('woodCount').textContent = game.wood;
  document.getElementById('raftStatus').textContent = game.wood >= 8 ? 'âœ… Pronta!' : `${game.wood}/8 pezzi`;
  document.getElementById('message').textContent = game.message;
}

// Input
document.addEventListener('keydown', e => { if(game) game.keys[e.key] = true; });
document.addEventListener('keyup', e => { if(game) game.keys[e.key] = false; });

function update() {
  if(!game) return;
  game.time++;
  const p = game.player;
  const k = game.keys;

  // Movement
  let dx = 0, dy = 0;
  if(k['ArrowLeft']||k['a']||k['A']) dx -= p.speed;
  if(k['ArrowRight']||k['d']||k['D']) dx += p.speed;
  if(k['ArrowUp']||k['w']||k['W']) dy -= p.speed;
  if(k['ArrowDown']||k['s']||k['S']) dy += p.speed;

  // Clamp to island (rough oval)
  const nx = p.x + dx, ny = p.y + dy;
  const cx = W/2, cy = H/2+30;
  const rx = W*0.43, ry = H*0.38;
  const ex = (nx-cx)/rx, ey = (ny-cy)/ry;
  if(ex*ex+ey*ey < 0.92) { p.x = nx; p.y = ny; }

  // Clamp canvas
  p.x = Math.max(20, Math.min(W-20, p.x));
  p.y = Math.max(20, Math.min(H-20, p.y));

  // Tree collection
  game.trees.forEach(t => {
    if(t.collected) return;
    const dist = Math.hypot(p.x - (t.x+15), p.y - (t.y+40));
    if(dist < 35) {
      t.collected = true;
      t.shake = 0;
      game.wood++;
      // particles
      for(let i=0;i<8;i++) game.particles.push({
        x: t.x+15, y: t.y+25,
        vx: (Math.random()-0.5)*3, vy: -Math.random()*3-1,
        life: 60, color: '#8B4513'
      });
      if(game.wood >= 8) {
        game.raft.visible = true;
        game.message = 'ðŸ›– Zattera costruita! Raggiungi la spiaggia (basso-destra)!';
      } else {
        game.message = `Legna raccolta: ${game.wood}/8 ðŸªµ`;
      }
      updateHUD();
    } else if(dist < 55) {
      t.shake = 1;
    } else {
      t.shake = 0;
    }
  });

  // Raft escape
  if(game.raft.visible && !game.raftBuilt) {
    const r = game.raft;
    if(p.x > r.x-10 && p.x < r.x+r.w+10 && p.y > r.y-10 && p.y < r.y+r.h+10) {
      game.raftBuilt = true;
      document.getElementById('winScreen').style.display = 'flex';
    }
  }

  // Particles
  game.particles = game.particles.filter(p => {
    p.x += p.vx; p.y += p.vy; p.vy += 0.1; p.life--;
    return p.life > 0;
  });

  // Waves
  game.waves.forEach(w => { w.x += w.speed; if(w.x > W+60) w.x = -60; });
}

function draw() {
  if(!game) return;
  const t = game.time;

  // Sky / ocean
  const skyGrad = ctx.createLinearGradient(0, 0, 0, H);
  skyGrad.addColorStop(0, '#1a3a5c');
  skyGrad.addColorStop(0.5, '#1e5f8a');
  skyGrad.addColorStop(1, '#1a7ab5');
  ctx.fillStyle = skyGrad;
  ctx.fillRect(0, 0, W, H);

  // Ocean shimmer
  ctx.save();
  ctx.globalAlpha = 0.08;
  for(let i=0;i<20;i++) {
    ctx.fillStyle = '#ffffff';
    ctx.fillRect(0, i*25+Math.sin(t*0.02+i)*5, W, 4);
  }
  ctx.restore();

  // Waves
  game.waves.forEach(w => {
    ctx.save();
    ctx.globalAlpha = 0.4;
    ctx.strokeStyle = '#7dd3f5';
    ctx.lineWidth = 2;
    ctx.beginPath();
    for(let i=0;i<80;i++) {
      const wx = w.x - 40 + i;
      const wy = w.y + Math.sin(wx*0.1+w.offset+t*0.04)*4;
      i===0 ? ctx.moveTo(wx,wy) : ctx.lineTo(wx,wy);
    }
    ctx.stroke();
    ctx.restore();
  });

  // Island shadow
  ctx.save();
  ctx.globalAlpha = 0.25;
  ctx.fillStyle = '#000';
  ctx.beginPath();
  ctx.ellipse(W/2+8, H/2+38, W*0.43, H*0.38, 0, 0, Math.PI*2);
  ctx.fill();
  ctx.restore();

  // Island base
  const islandGrad = ctx.createRadialGradient(W/2, H/2+30, 0, W/2, H/2+30, W*0.45);
  islandGrad.addColorStop(0, '#4a8c3f');
  islandGrad.addColorStop(0.6, '#3d7a34');
  islandGrad.addColorStop(0.85, '#c8a84b');
  islandGrad.addColorStop(1, '#d4b85a');
  ctx.fillStyle = islandGrad;
  ctx.beginPath();
  ctx.ellipse(W/2, H/2+30, W*0.43, H*0.38, 0, 0, Math.PI*2);
  ctx.fill();

  // Island texture dots
  ctx.save();
  ctx.globalAlpha = 0.12;
  ctx.fillStyle = '#2d5a27';
  for(let i=0;i<30;i++) {
    ctx.beginPath();
    ctx.arc(120+i*18, 200+Math.sin(i*1.3)*80, 15+Math.cos(i)*8, 0, Math.PI*2);
    ctx.fill();
  }
  ctx.restore();

  // Beach edge
  ctx.save();
  ctx.globalAlpha = 0.5;
  ctx.strokeStyle = '#d4b85a';
  ctx.lineWidth = 8;
  ctx.setLineDash([15,8]);
  ctx.beginPath();
  ctx.ellipse(W/2, H/2+30, W*0.43, H*0.38, 0, 0, Math.PI*2);
  ctx.stroke();
  ctx.setLineDash([]);
  ctx.restore();

  // Trees
  game.trees.forEach(tree => {
    if(tree.collected) return;
    const sx = tree.shake ? Math.sin(t*0.5)*2 : 0;
    const tx = tree.x + sx;
    // Trunk
    ctx.fillStyle = '#5C3317';
    ctx.fillRect(tx+11, tree.y+25, 8, 25);
    // Leaves (3 layers)
    [[15, 0, 22],[20, -10, 18],[14, -20, 14]].forEach(([cy,oy,r],i) => {
      const g = ctx.createRadialGradient(tx+15, tree.y+cy+oy, 0, tx+15, tree.y+cy+oy, r);
      g.addColorStop(0, i===0?'#5dbf4e':'#4aad3f');
      g.addColorStop(1, '#2d6e22');
      ctx.fillStyle = g;
      ctx.beginPath();
      ctx.arc(tx+15, tree.y+cy+oy, r, 0, Math.PI*2);
      ctx.fill();
    });
    // Nearby glow
    const dist2 = Math.hypot(game.player.x-(tree.x+15), game.player.y-(tree.y+40));
    if(dist2 < 55) {
      ctx.save();
      ctx.globalAlpha = 0.3 * (1-dist2/55);
      ctx.fillStyle = '#ffff88';
      ctx.beginPath();
      ctx.arc(tx+15, tree.y+15, 28, 0, Math.PI*2);
      ctx.fill();
      ctx.restore();
      // "Premi E / avvicinati" label
      ctx.fillStyle = '#ffff00';
      ctx.font = 'bold 11px Crimson Pro, serif';
      ctx.textAlign = 'center';
      ctx.fillText('ðŸªµ RACCOGLI', tx+15, tree.y-5);
    }
  });

  // Raft
  if(game.raft.visible) {
    const r = game.raft;
    const bob = Math.sin(t*0.05)*3;
    ctx.save();
    ctx.translate(r.x, r.y + bob);
    // Logs
    for(let i=0;i<3;i++) {
      ctx.fillStyle = '#8B4513';
      ctx.fillRect(0, i*10, r.w, 8);
      ctx.strokeStyle = '#5C2D0A';
      ctx.lineWidth = 1;
      ctx.strokeRect(0, i*10, r.w, 8);
    }
    // Sail
    ctx.fillStyle = '#f5e6c0';
    ctx.beginPath();
    ctx.moveTo(20,0); ctx.lineTo(20,-35); ctx.lineTo(40,0); ctx.closePath();
    ctx.fill();
    ctx.strokeStyle = '#8B4513'; ctx.lineWidth=2;
    ctx.beginPath(); ctx.moveTo(20,8); ctx.lineTo(20,-38); ctx.stroke();
    // Label
    ctx.fillStyle = '#f0c040';
    ctx.font = 'bold 12px Pirata One, cursive';
    ctx.textAlign = 'center';
    ctx.fillText('â›µ ZATTERA', r.w/2, -45);
    ctx.restore();

    // Glow around raft
    const pr = game.player;
    const rd = Math.hypot(pr.x-(r.x+r.w/2), pr.y-(r.y+r.h/2));
    if(rd < 70) {
      ctx.save();
      ctx.globalAlpha = 0.4*(1-rd/70);
      ctx.fillStyle = '#f0c040';
      ctx.beginPath();
      ctx.arc(r.x+r.w/2, r.y+bob+r.h/2, 35, 0, Math.PI*2);
      ctx.fill();
      ctx.restore();
      ctx.fillStyle = '#f0c040';
      ctx.font = 'bold 13px Crimson Pro, serif';
      ctx.textAlign = 'center';
      ctx.fillText('âž¡ FUGGI!', r.x+r.w/2, r.y+bob-15);
    }
  }

  // Particles
  game.particles.forEach(p => {
    ctx.save();
    ctx.globalAlpha = p.life/60;
    ctx.fillStyle = p.color;
    ctx.fillRect(p.x-3, p.y-3, 6, 6);
    ctx.restore();
  });

  // Player
  const p = game.player;
  const walkCycle = Math.sin(t*0.25);
  // Shadow
  ctx.save(); ctx.globalAlpha=0.3; ctx.fillStyle='#000';
  ctx.beginPath(); ctx.ellipse(p.x, p.y+13, 8, 4, 0, 0, Math.PI*2); ctx.fill(); ctx.restore();
  // Legs
  ctx.fillStyle = '#4a3728';
  ctx.fillRect(p.x-5+walkCycle*2, p.y+8, 5, 10);
  ctx.fillRect(p.x, p.y+8, 5, 10);
  // Body
  ctx.fillStyle = '#c0392b';
  ctx.beginPath(); ctx.roundRect(p.x-7, p.y-4, 14, 13, 3); ctx.fill();
  // Arms
  ctx.fillStyle = '#e8c17a';
  ctx.fillRect(p.x-10, p.y-2+walkCycle*2, 4, 8);
  ctx.fillRect(p.x+6, p.y-2-walkCycle*2, 4, 8);
  // Head
  ctx.fillStyle = '#e8c17a';
  ctx.beginPath(); ctx.arc(p.x, p.y-9, 8, 0, Math.PI*2); ctx.fill();
  // Hat
  ctx.fillStyle = '#8B4513';
  ctx.fillRect(p.x-9, p.y-14, 18, 3);
  ctx.fillRect(p.x-5, p.y-22, 10, 10);
  // Eyes
  ctx.fillStyle = '#1a0a00';
  ctx.fillRect(p.x-3, p.y-11, 2, 2);
  ctx.fillRect(p.x+1, p.y-11, 2, 2);

  // Progress bar
  const bw = 200, bh = 14;
  const bx = W/2-bw/2, by = H-30;
  ctx.fillStyle = 'rgba(0,0,0,0.5)';
  ctx.beginPath(); ctx.roundRect(bx, by, bw, bh, 7); ctx.fill();
  const pg = ctx.createLinearGradient(bx, 0, bx+bw, 0);
  pg.addColorStop(0,'#8b4513'); pg.addColorStop(1,'#f0c040');
  ctx.fillStyle = pg;
  ctx.beginPath(); ctx.roundRect(bx, by, bw*(Math.min(game.wood,8)/8), bh, 7); ctx.fill();
  ctx.strokeStyle = '#8b6914'; ctx.lineWidth=1;
  ctx.beginPath(); ctx.roundRect(bx, by, bw, bh, 7); ctx.stroke();
  ctx.fillStyle = '#e8d5a3'; ctx.font='10px Crimson Pro,serif'; ctx.textAlign='center';
  ctx.fillText(`Legna ${game.wood}/8`, W/2, by+10);
}

function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}

initGame();
loop();
</script>
</body>
</html>
